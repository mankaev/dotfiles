#!/bin/sh

ffmpeg -hide_banner -threads 5 -vaapi_device /dev/dri/renderD128 -hwaccel vaapi -thread_queue_size 512 -f x11grab -s 1600x900 -r 30 -i :0.0 -thread_queue_size 512 -f v4l2 -s 320x180 -i /dev/video0 -f pulse -ac 2 -ar 44100 -i alsa_input.hw_1_0 -thread_queue_size 512 -f pulse -ac 2 -ar 44100 -i alsa_output.pci-0000_00_1b.0.analog-stereo.monitor -filter_complex "amix=inputs=2" -c:a libopus -b:a 64k -c:v h264_vaapi -filter_complex "[0:v]setpts=PTS-STARTPTS[bg];[1:v]scale=320:-1,setpts=PTS-STARTPTS[fg];[bg][fg]overlay=W-w-10:10[v];[v]format=nv12,hwupload[out]" -map "[out]" -map 2:a "screencamcast_$(date +%m%d%Y_%T).mkv"
